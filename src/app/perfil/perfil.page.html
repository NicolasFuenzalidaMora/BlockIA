<!-- Perfil en estilo tarjeta centrada + barra inferior reutilizable -->

<ion-content [fullscreen]="true" class="perfil-content">

  <div class="perfil-sheet ion-padding">

    <!-- ESTADO: CARGANDO -->
    <div *ngIf="cargando" class="perfil-loading">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando perfil...</p>
    </div>

    <!-- ESTADO: PERFIL CARGADO -->
    <ng-container *ngIf="!cargando && userProfile">

      <section class="perfil-card">

        <!-- Avatar + nombre + teléfono -->
        <div class="perfil-avatar">
          <div class="avatar-ring">
            <ion-avatar class="avatar-img">
              <img
                [src]="userProfile.fotoUrl || 'https://ionicframework.com/docs/img/demos/avatar.svg'"
                alt="Foto de usuario" />
            </ion-avatar>
          </div>

          <h2 class="perfil-name">{{ userProfile.nombre || 'Usuario' }}</h2>

          <p class="perfil-phone">
            {{ userProfile.telefono || userProfile.phone || userProfile.telefonoUsuario || '' }}
          </p>
        </div>

        <!-- Bloques de información -->
        <div class="perfil-info">

          <!-- ✅ CONDOMINIO (con acordeón cuando hay varios) -->
          <div class="info-row">
            <div class="info-icon">
              <ion-icon name="business-outline"></ion-icon>
            </div>
            <div class="info-body">
              <p class="info-label">CONDOMINIO</p>

              <!-- Texto resumido (el mismo que ya tenías) -->
              <p class="info-value">
                {{ userProfile.nombreCondominio || 'Sin condominio asignado' }}
              </p>

              <!-- Acordeón solo si hay MÁS DE 1 condominio -->
              <div
                *ngIf="userProfile.condominiosDetallados?.length > 1"
                class="info-extra">

                <ion-accordion-group>
                  <ion-accordion value="condominios">
                    <!-- Cabecera del acordeón -->
                    <ion-item slot="header" lines="none">
                      <ion-label>
                        Ver todos los condominios ({{ userProfile.condominiosDetallados.length }})
                      </ion-label>
                    </ion-item>

                    <!-- Contenido del acordeón -->
<div slot="content" class="condos-list ion-padding-start ion-padding-bottom">
  <div
    class="condo-item"
    *ngFor="let c of userProfile.condominiosDetallados">
    <div class="condo-name">{{ c.nombre }}</div>
  </div>
</div>
                  </ion-accordion>
                </ion-accordion-group>

              </div>
            </div>
          </div>

          <!-- Departamento / Casa -->
          <div class="info-row">
            <div class="info-icon">
              <ion-icon name="home-outline"></ion-icon>
            </div>
            <div class="info-body">
              <p class="info-label">DEPARTAMENTO / CASA</p>
              <p class="info-value">
                {{ userProfile.departamento || userProfile.departamentoCasa || '-' }}
              </p>
            </div>
          </div>

          <!-- Patentes asociadas -->
          <div class="info-row">
            <div class="info-icon">
              <ion-icon name="car-sport-outline"></ion-icon>
            </div>
            <div class="info-body">
              <p class="info-label">PATENTES ASOCIADAS</p>

              <p class="info-value" *ngIf="userProfile.patentes?.length; else sinPatentes">
                <span
                  class="plate-tag"
                  *ngFor="let p of userProfile.patentes; let i = index">
                  {{ p }}
                </span>
              </p>

              <ng-template #sinPatentes>
                <p class="info-value info-value--muted">
                  Sin patentes registradas
                </p>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Botones -->
        <div class="perfil-actions">
          <ion-button expand="block" class="perfil-btn-primary" (click)="editarPerfil()">
            <ion-icon slot="start" name="create-outline"></ion-icon>
            EDITAR PERFIL
          </ion-button>

          <ion-button
            expand="block"
            fill="clear"
            class="perfil-btn-logout"
            (click)="logout()">
            <ion-icon slot="start" name="log-out-outline"></ion-icon>
            CERRAR SESIÓN
          </ion-button>
        </div>

      </section>
    </ng-container>

    <!-- ESTADO: SIN PERFIL -->
    <div *ngIf="!cargando && !userProfile" class="perfil-empty">
      <ion-icon name="person-circle-outline"></ion-icon>
      <p>No se pudo cargar la información del perfil.</p>
    </div>

  </div>

  <!-- Barra inferior de navegación tipo app móvil -->
  <app-menu-lateral></app-menu-lateral>
</ion-content>
