<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-menu-button menu="first"></ion-menu-button>
    </ion-buttons>
    <ion-title>Inicio</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="wrapper ion-padding">

    <div [ngSwitch]="estadoUsuario" class="content-switch-container">

      <div *ngSwitchCase="'cargando'" class="estado-container">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Cargando tu información...</p>
      </div>

      <div *ngSwitchCase="'pendiente'" class="estado-container pendiente">
        <ion-icon name="hourglass-outline"></ion-icon>
        <h2>Solicitud Pendiente</h2>
        <p>{{ statusMessage || 'Tu cuenta está pendiente de aprobación o no tienes acceso activo.' }}</p>
        <p *ngIf="!statusMessage">Serás notificado cuando tengas acceso.</p>
      </div>

       <div *ngSwitchCase="'incompleto'" class="estado-container pendiente">
        <ion-icon name="person-outline"></ion-icon>
        <h2>Perfil Incompleto</h2>
        <p>Necesitas completar tu perfil para continuar.</p>
        <ion-button routerLink="/completar-perfil">Ir a Completar Perfil</ion-button>
      </div>

      <div *ngSwitchCase="'aprobado'" class="aprobado-container">

          <b>Presione para activar</b>

          <button
            class="material-button"
            [style.background-color]="buttonColor"
            [disabled]="calling || !patenteSeleccionada || !condominioSeleccionado"
            (click)="enviarSMS()">
            {{ calling ? Message : 'Abrir' }}
          </button>

          <p class="status">{{ statusMessage }}</p>

          <div class="context-container ion-padding-top" *ngIf="condominioSeleccionado || patenteSeleccionada">

            <div *ngIf="condominioSeleccionado" class="context-display">
              <p>Actuando en:</p>
              <h2>{{ condominioSeleccionado.nombre }}</h2>
              <ion-button fill="clear" size="small" (click)="cambiarCondominio()" *ngIf="misCondominiosCompletos && misCondominiosCompletos.length > 1">
                Cambiar de condominio
              </ion-button>
            </div>

            <div *ngIf="patenteSeleccionada" class="patente-display">
              <p>Vehículo seleccionado:</p>
              <h2>{{ patenteSeleccionada }}</h2>
              <ion-button fill="clear" size="small" (click)="cambiarPatente()" *ngIf="userProfile?.patentes?.length > 1">
                Cambiar de patente
              </ion-button>
            </div>

          </div> <div *ngIf="!cargandoPerfil && (!patenteSeleccionada || !condominioSeleccionado)" class="missing-info ion-padding">
                <p>⚠️ Esperando selección...</p>
          </div>

      </div>
     </div>
     </div> 
    </ion-content>